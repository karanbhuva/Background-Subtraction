import cv2
import numpy as np

cap = cv2.VideoCapture("highway.mp4")

background=cv2.imread("highway clean.png")
background_gray=cv2.cvtColor(background,cv2.COLOR_BGR2GRAY)
kernel = np.ones((3,3),np.uint8)

try:
    while True:
        cv2.namedWindow('frame:',cv2.WINDOW_NORMAL)
        cv2.resizeWindow('frame:', 400,400)
        cv2.namedWindow('background:',cv2.WINDOW_NORMAL)
        cv2.resizeWindow('background:', 400,400)
        cv2.namedWindow('background difference:',cv2.WINDOW_NORMAL)
        cv2.resizeWindow('background difference:',400,400)
        
        _,frame=cap.read()
        gray_frame=cv2.cvtColor(frame,cv2.COLOR_BGR2GRAY)

        difference2=cv2.absdiff(gray_frame,background_gray)
        _,difference2=cv2.threshold(difference2,25,255,cv2.THRESH_BINARY)
        difference2 = cv2.morphologyEx(difference2, cv2.MORPH_OPEN, kernel)
        
        cv2.imshow("frame:",frame)
        cv2.imshow("background:",background_gray)
        cv2.imshow("background difference:",difference2)
        
      
        key=cv2.waitKey(1)
        if key & 0xFF == ord('p'): #quit if key p is pressed
            break
    cap.release()
    cv2.destroyAllWindows()
except:
    cap.release()
    cv2.destroyAllWindows()
